<?phpinclude ("../script/SCRIPTstyles.php");include ("../script/SCRIPTconnect.php");include ("../script/SCRIPTinclude.php");function gibtabelle ($tabelle, $mannschaften, $gruppe){	include ("../script/SCRIPTstyles.php");	$textstyle = fontSizeColor(1, "black");	global $wettkampfid;	echo "<TABLE cellspacing=\"1\" $bgcolor35 $border0 $center>";//	echo "<tr><th $cspn10 $center><font size=4>Tabelle der Gruppe $gruppe</TH></TR>";	echo "<TR $bgcolor35>";	echo "<TH>$textstyle &nbsp; Mannschaft &nbsp;</TH>";	echo "<TH>$textstyle &nbsp;Spiele &nbsp;</TH>";	echo "<TH $cspn3>$textstyle &nbsp; G &nbsp;&nbsp;  &nbsp;&nbsp; U &nbsp;&nbsp;  &nbsp;&nbsp; V &nbsp;&nbsp;</TH>";	echo "<TH $cspn3>$textstyle &nbsp;Tore &nbsp;</TH>";	echo "<TH>$textstyle &nbsp;Diff &nbsp;</TH>";	echo "<TH>$textstyle &nbsp;Punkte &nbsp;</TH>";	echo "</TR>";	$i = 1;	$viertelfinale = array( "$mannschaften[0]", "$mannschaften[1]");//	echo $viertelfinale[0];//	echo $viertelfinale[1];	$gegner = array();	foreach($viertelfinale as $m)	{		switch ($i)		{			case $i <= 2:				$bgcolor = $bgcolor37;				break;			case $i <= 5:				$bgcolor = $bgcolor36;				break;			case $i > 15:				$bgcolor = $bgcolor39;				break;		}		if (!$tabelle["$m"]["win"]) $tabelle["$m"]["win"] = "-";		if (!$tabelle["$m"]["duce"]) $tabelle["$m"]["duce"] = "-";		if (!$tabelle["$m"]["lose"]) $tabelle["$m"]["lose"] = "-";			echo "<TR $bgcolor>";		echo "<TD $center>";				echo "<table width=\"100%\" border=\"0\"><tr>";				echo "<td>$textstyle " . $i . ".</b></td>";				echo "<td $left $top width=\"28\">";				echo "<img src=\"../img/Wappen/";			global $db;			$spruch  = "SELECT wappen_src FROM team";			$spruch .= " WHERE team.name = '$m'";			$result = mysql_query( $spruch, $db ) or die("Query failed : " . mysql_error());			$row = mysql_fetch_array($result, MYSQL_ASSOC);				echo $row['wappen_src'];				echo "\" alt=\"$m\" height=\"15\">";				echo "</td>";				echo "<TD $left>$textstyle $m </TD>";				echo "</td></tr></table>";		echo "</TD>";		echo "<TD $center>";		echo "$textstyle &nbsp;" . $tabelle["$m"]["spiel"] . " &nbsp;</TD>";		echo "<TD $center>$textstyle &nbsp;" . $tabelle["$m"]["win"] . " &nbsp;</TD>";		echo "<TD $center>$textstyle &nbsp;" . $tabelle["$m"]["duce"] . " &nbsp;</TD>";		echo "<TD $center>$textstyle &nbsp;" . $tabelle["$m"]["lose"] . " &nbsp;</TD>";		echo "<TD $center>$textstyle" . $tabelle["$m"]["raus"] . "</TD>";		echo "<TD $center>:</TD>";		echo "<TD $center>$textstyle" . $tabelle["$m"]["rein"] . "</TD>";		$diff = $tabelle["$m"]["raus"] - $tabelle["$m"]["rein"];		echo "<TD $center>$textstyle &nbsp;" . $diff . " &nbsp;</TD>";		echo "<TD $center>$textstyle &nbsp;" . $tabelle["$m"]["punkte"] . " &nbsp;</TD>";		echo "</TR>";		$bgcolor = $bgcolor38;		$i++;	}	echo "<tr><td $cspn10>&nbsp;</td></tr>"; // Freie Zeile in Tabelle	echo "</TABLE>";	return $viertelfinale;}function TabelleAusSpiel($spieltag, $result){	global $db;	global $tabelle;	$heim = array();	$gast = array();	$heim_id = array();	$gast_id = array();	$tore_heim = array();	$tore_gast = array();	$spieltag = array();	while ($row = mysql_fetch_array($result, MYSQL_ASSOC))	{//		echo $row['heim'] . " : " . $row['gast'];//		echo $row['tore_heim'] . " : " . $row['tore_gast'] . "<BR>";		$heim[] = $row['heim'];		$gast[] = $row['gast'];		$heim_id[] = $row['heim_team_id'];		$gast_id[] = $row['gast_team_id'];		$tore_heim[] = $row['tore_heim'];		$tore_gast[] = $row['tore_gast'];		$spieltag[] = $row['spieltag'];	}	for ($i=0;$i<count($heim);$i++)	{		if ( $tore_heim[$i] == "" || $tore_gast[$i] == "" ) continue;		$tabelle["${heim[$i]}"]["id"] = $heim_id[$i];		$tabelle["${gast[$i]}"]["id"] = $gast_id[$i];		$tabelle["${heim[$i]}"]["spiel"] = $spieltag[$i];		$tabelle["${gast[$i]}"]["spiel"] = $spieltag[$i];		if ($tore_heim[$i] > $tore_gast[$i])		{			// Punkte			$tabelle["${heim[$i]}"]["punkte"] = $tabelle["${heim[$i]}"]["punkte"] + 3;			$tabelle["${gast[$i]}"]["punkte"] = $tabelle["${gast[$i]}"]["punkte"] + 0;			// Tore geschossen			$tabelle["${heim[$i]}"]["raus"] = $tabelle["${heim[$i]}"]["raus"] + $tore_heim[$i];			$tabelle["${gast[$i]}"]["raus"] = $tabelle["${gast[$i]}"]["raus"] + $tore_gast[$i];			// Tore gekriegt			$tabelle["${heim[$i]}"]["rein"] = $tabelle["${heim[$i]}"]["rein"] + $tore_gast[$i];			$tabelle["${gast[$i]}"]["rein"] = $tabelle["${gast[$i]}"]["rein"] + $tore_heim[$i];			// Spiele gewonenn			$tabelle["${heim[$i]}"]["win"] = $tabelle["${heim[$i]}"]["win"] + 1;			// spiele verloren			$tabelle["${gast[$i]}"]["lose"] = $tabelle["${gast[$i]}"]["lose"] + 1;		}		if ($tore_heim[$i] == $tore_gast[$i])		{			$tabelle["${heim[$i]}"]["punkte"] = $tabelle["${heim[$i]}"]["punkte"] + 1;			$tabelle["${gast[$i]}"]["punkte"] = $tabelle["${gast[$i]}"]["punkte"] + 1;			$tabelle["${heim[$i]}"]["raus"] = $tabelle["${heim[$i]}"]["raus"] + $tore_heim[$i];			$tabelle["${gast[$i]}"]["raus"] = $tabelle["${gast[$i]}"]["raus"] + $tore_gast[$i];			$tabelle["${heim[$i]}"]["rein"] = $tabelle["${heim[$i]}"]["rein"] + $tore_gast[$i];			$tabelle["${gast[$i]}"]["rein"] = $tabelle["${gast[$i]}"]["rein"] + $tore_heim[$i];			// Spiele unentschieden			$tabelle["${heim[$i]}"]["duce"] = $tabelle["${heim[$i]}"]["duce"] + 1;			$tabelle["${gast[$i]}"]["duce"] = $tabelle["${gast[$i]}"]["duce"] + 1;		}		if ($tore_heim[$i] < $tore_gast[$i])		{			$tabelle["${heim[$i]}"]["punkte"] = $tabelle["${heim[$i]}"]["punkte"] + 0;			$tabelle["${gast[$i]}"]["punkte"] = $tabelle["${gast[$i]}"]["punkte"] + 3;			$tabelle["${heim[$i]}"]["raus"] = $tabelle["${heim[$i]}"]["raus"] + $tore_heim[$i];			$tabelle["${gast[$i]}"]["raus"] = $tabelle["${gast[$i]}"]["raus"] + $tore_gast[$i];			$tabelle["${heim[$i]}"]["rein"] = $tabelle["${heim[$i]}"]["rein"] + $tore_gast[$i];			$tabelle["${gast[$i]}"]["rein"] = $tabelle["${gast[$i]}"]["rein"] + $tore_heim[$i];			$tabelle["${heim[$i]}"]["lose"] = $tabelle["${heim[$i]}"]["lose"] + 1;			$tabelle["${gast[$i]}"]["win"] = $tabelle["${gast[$i]}"]["win"] + 1;		}	}}if (!$spieltag) $spieltag = 1;function SpieleAusDBtabelle($wettkampfid, $spieltag, $gruppe){	global $db;		$penalty = array();	$spruch  = "SELECT penalty.team_id, SUM(penalty) AS gesamtpenalty, team.name AS teamname";	$spruch .= " FROM penalty";	$spruch .= " INNER JOIN team ON penalty.team_id = team.id";	$spruch .= " WHERE wettkampf_id = $wettkampfid";	$spruch .= " GROUP BY penalty.team_id";	$spruch .= " ORDER BY gesamtpenalty DESC";//	echo $spruch;		$result = mysql_query( $spruch, $db ) or die("Query failed : " . mysql_error());	while ($row = mysql_fetch_array($result, MYSQL_ASSOC))	{		$a = $row['teamname'];		$penalty["$a"] = $row['gesamtpenalty'];	}	$tabelle = array();	global $tabelle;		$spruch = "SELECT liga_spiel.id, spieltag, heim_team_id, gast_team_id, tore_heim, tore_gast,";	$spruch .= " team.name AS heim, team2.name AS gast";	$spruch .= " FROM liga_spiel";	$spruch .= " LEFT JOIN team ON liga_spiel.heim_team_id = team.id";	$spruch .= " LEFT JOIN team AS team2 ON liga_spiel.gast_team_id = team2.id";	$spruch .= " WHERE wettkampf_id = $wettkampfid AND spieltag <= $spieltag and gruppe = '$gruppe' " ; #AND done != 1	$spruch .= " ORDER BY spieltag ASC";//	echo "<BR>$spruch<BR>" ;	$result = mysql_query($spruch, $db);/*	$anzahl = mysql_num_rows($result);	echo "<BR> <BR> $anzahl <BR> <BR>";	if (mysql_num_rows($result) == 0)	{		echo "<BR> <BR>Kein Spiele<BR><BR>";		exit();	}*/	TabelleAusSpiel($spieltag, $result);//	echo "ACK<BR>";	if (empty($tabelle)){ echo "Keine Spiele" ;return; }	$mannschaften = array();	$mannschaften = array_keys($tabelle);//	echo "ACK23<BR>";	$punkte = array();	$tore_raus = array();	$tore_rein = array();	$diff = array();//echo "<TABLE BORDER=\"1\"><TR><TD>";//gibtabelle($tabelle, $mannschaften);//echo "</TD>";//echo "<TD>"; //	echo "<BR> HASNA HASNA <BR>";	foreach ($mannschaften as $m)	{		if ($penalty["$m"])		{			$tabelle["$m"]["punkte"] = $tabelle["$m"]["punkte"] - $penalty["$m"];		}		$punkte[] = $tabelle["$m"]["punkte"];		$tore_raus[] = $tabelle["$m"]["raus"];		$tore_rein[] = $tabelle["$m"]["rein"];		$diff[] = $tabelle["$m"]["raus"] - $tabelle["$m"]["rein"];	}	array_multisort ($punkte, SORT_DESC, SORT_NUMERIC, $diff, SORT_DESC, SORT_NUMERIC, $tore_raus, SORT_DESC, SORT_NUMERIC, $mannschaften);//	$bla = array();	$bla[] = gibtabelle($tabelle, $mannschaften, $gruppe);//	echo $bla[0][0];//	echo $bla[0][1];	return $bla;}if ($datumda == 0 ) {	$g = array("A", "B", "C", "D");	$blubb = array();	for ($i=0;$i<count($g);$i++)	{	    	$font  = fontSizeColor(3, $txtcol8); 	    	$font2 = fontSizeColor(3, $txtcol9);		$blubb[$i] = SpieleAusDBtabelle($wettkampfid, $spieltag, $g[$i]);		$tabelle = '';		$i++;		$blubb[$i] = SpieleAusDBtabelle($wettkampfid, $spieltag, $g[$i]);		$tabelle = '';	}	echo "<BR><BR><BR>";	echo "<FORM METHOD=\"post\" NAME=\"em\" ACTION=\"EM-Viertel.php\">";	echo "<TABLE>";	echo "<TR>";	echo "<TD COLSPAN=\"5\" align=\"right\"> Datum / Zeit</TD>";	echo "</TR>";	for ($i=0;$i<count($g);$i++)	{		$heim = $blubb[$i][0][0];		$gast = $blubb[$i+1][0][1];		echo "<input type=\"hidden\" NAME=\"heim_$i\" VALUE=\"$heim\">";		echo "<input type=\"hidden\" NAME=\"gast_$i\" VALUE=\"$gast\">";		echo "<TR><TD>$heim</TD><TD>:</TD><TD>$gast</TD>";		echo "<TD><input type=\"text\" maxlength=\"5\" size=\"5\" name=\"datum_$i\"></TD>";		echo "<TD><input type=\"text\" maxlength=\"5\" size=\"5\" name=\"zeit_$i\"></TD>";		echo "</TR>";		$i++;		$heim = $blubb[$i][0][0];		$gast = $blubb[$i-1][0][1];		echo "<input type=\"hidden\" NAME=\"heim_$i\" VALUE=\"$heim\">";		echo "<input type=\"hidden\" NAME=\"gast_$i\" VALUE=\"$gast\">";		echo "<TR><TD>$heim</TD><TD>:</TD><TD>$gast</TD>";		echo "<TD><input type=\"text\" maxlength=\"5\" size=\"5\" name=\"datum_$i\"></TD>";		echo "<TD><input type=\"text\" maxlength=\"5\" size=\"5\" name=\"zeit_$i\"></TD>";		echo "</TR>";	}	echo "</TABLE>";	echo "<input type=\"hidden\" NAME=\"datumda\" VALUE=\"1\">";	echo "<input type=\"hidden\" NAME=\"wettkampfid\" VALUE=\"$wettkampfid\">";	echo "<input type=\"submit\" value=\"Weiter\" name=\"submitButtonName\" border=\"0\">";	echo "</FORM>";} else {	include ("SCRIPTconnect.php");	echo "$wettkampfid <BR>";	$spruch = "SELECT saison FROM wettkampf where id = $wettkampfid";	$result = mysql_query($spruch, $db);	$row = mysql_fetch_row($result);	$saison = $row[0];	echo $saison . "<BR>";	ereg("[0-9]{4}", $saison, $jahr);	for($i=0;$i<4;$i++)	{		$heim = "heim_$i";		$gast = "gast_$i";		$datum_hin = "datum_$i";		$zeit = "zeit_$i";		$hin = "${jahr[0]}.${$datum_hin} ${$zeit}:00";		${$datum_hin} = ereg_replace("\.", "-", "$hin");		echo ${$heim} . " : " . ${$gast} . " : " . ${$datum_hin} . "<BR>";		$spruch = "SELECT id FROM team WHERE name = '${$heim}'";		$result = mysql_query($spruch, $db);		$row = mysql_fetch_row($result);		$h_id = $row[0];		$spruch = "SELECT id FROM team WHERE name = '${$gast}'";		$result = mysql_query($spruch, $db);		$row = mysql_fetch_row($result);		$g_id = $row[0];		$gruppe = $i + 1;		$spruch = "INSERT INTO liga_spiel (wettkampf_id, spieltag, datum, heim_team_id, gast_team_id, gruppe,done)";		$spruch .= " VALUES ($wettkampfid, 4, '${$datum_hin}', $h_id, $g_id, '$gruppe', 0)";		echo "<BR> $spruch <BR>";		$result = mysql_query($spruch, $db);	}}?>